<html>
<head>
<title>Simple Shift Plot</title>
<!-- <script src="d3/d3.js" charset="utf-8"></script> -->
<script src="static/d3.v3.min.js" charset="utf-8"></script>
<script src="static/plotShift.js" charset="utf-8"></script>
<script src="static/shift.js" charset="utf-8"></script>
<script src="static/drawLens.js" charset="utf-8"></script>
  <style>
    body {
      font-family: Verdana,Arial,sans-serif;
    }

    h4 {
    font-size: .8em;
    margin: 60px 0 5px 0;
    }

    h5 {
    font-size: .8em;
    margin: 10px 0 5px 0;
    }

    body {
    min-width: 650px;
    }

    #caption01 {
      width: 500px;
    }

    #lens01 {
      width: 600px;
    }

    #figure01 {
      width: 600px;
    }

    .domain {
      fill: none;
      stroke: black;
      stroke-width: 2;
     }

  </style>
</head>
<body>

<div id="header"></div>
<!-- <h4>Select the reference: <select id="refSelect"><option value="none">none</option></select> Select the comparison: <select id="compSelect"><option value="none">none</option></select></h4> -->
<center>

<div id="caption01">
Move the stop-window to remove words from the lense.
Removing 4 though 6, the default, corresponds to the tuned hedonometer for large corpuses.</div>
<br>

<div id="lens01" class="figure"></div>

<br>

Click on the graph and drag up to reveal additional words.

<div id="figure01" class="figure"></div>

</center>

<div id="footer"></div>

<script>
function initializePlot() {
    loadCsv();
}

function loadCsv() {
var csvLoadsRemaining = 4;
d3.text("data/count_of_monte_cristo_freq1.txt", function(text) {
    var tmp = text.split("\n");
    refFraw = tmp;
    var len = refFraw.length-1;
    while (!refFraw[len]) { console.log("in while loop"); refFraw = refFraw.slice(0,len); len--; } 
    if (!--csvLoadsRemaining) initializePlotPlot(refFraw,compFraw,lens,words);
});
d3.text("data/french_scores.txt", function(text) {
    var tmp = text.split("\n");
    console.log(tmp.length);
    console.log(tmp[tmp.length-1]);
    lens = tmp.map(parseFloat);
    var len = lens.length-1;
    while (!lens[len]) { console.log("in while loop"); lens = lens.slice(0,len); len--; } 
    if (!--csvLoadsRemaining) initializePlotPlot(refFraw,compFraw,lens,words);
});
d3.text("data/french_words.txt", function(text) {
    var tmp = text.split("\n");
    words = tmp;
    var len = words.length-1;
    while (!words[len]) { console.log("in while loop"); words = words.slice(0,len); len--; } 
    if (!--csvLoadsRemaining) initializePlotPlot(refFraw,compFraw,lens,words);
});
d3.text("data/count_of_monte_cristo_freq2.txt", function(text) {
    var tmp = text.split("\n");
    compFraw = tmp;
    var len = compFraw.length-1;
    while (!compFraw[len]) { console.log("in while loop"); compFraw = compFraw.slice(0,len); len--; } 
    if (!--csvLoadsRemaining) initializePlotPlot(refFraw,compFraw,lens,words);
});
};

function initializePlotPlot(refFraw,compFraw,lens,words) {
    // draw the lens
    drawLens(d3.select("#lens01"),lens,refFraw,compFraw);

    // initially apply the lens, and draw the shift
    refF = Array(refFraw.length);
    compF = Array(compFraw.length);
    for (var i=0; i<compFraw.length; i++) {
	if (lens[i] > 4 && lens[i] < 6) {
            refF[i]= 0;
            compF[i]= 0;
        }
	else {
            refF[i]= parseFloat(refFraw[i]);
            compF[i]= parseFloat(compFraw[i]);
	}
    }
    shiftObj = shift(refF,compF,lens,words);
    plotShift(d3.select("#figure01"),shiftObj.sortedMag.slice(0,200),
              shiftObj.sortedType.slice(0,200),
              shiftObj.sortedWords.slice(0,200),
              shiftObj.sumTypes,
              shiftObj.refH,
              shiftObj.compH);

};

initializePlot();

</script>
  <!-- <style> -->
  <!--   .domain { -->
  <!--     stroke-width: 0.5; -->
  <!--    } -->

  <!-- </style> -->

</body>
</html>


