function plotShift(e,t,n,r,i,s,o,u){function P(){d3.selectAll(".resetbutton").remove();var e=w.append("g").attr("class","resetbutton");e.append("rect").attr("x",385).attr("y",133).attr("rx",3).attr("ry",3).attr("width",48).attr("height",16).attr("fill","#F0F0F0").style({"stroke-width":"0.5",stroke:"rgb(0,0,0)"});e.append("text").text("Reset").attr("x",393).attr("y",144).attr("font-size","11.0px");e.append("rect").attr("x",385).attr("y",133).attr("rx",3).attr("ry",3).attr("width",48).attr("height",16).attr("fill","white").style({opacity:"0.0"}).on("click",function(){b=false;S.selectAll("rect.shiftrect").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform","translate(0,0)").attr("x",function(e,t){if(e<0){return x(e)}else{return p}});S.selectAll("text.shifttext").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("x",function(e,t){if(e<0){return x(e)-2}else{return x(e)+2}}).attr("transform","translate(0,0)");d3.selectAll(".resetbutton").remove()})}function H(){if(b){for(var e=0;e<4;e++){S.selectAll("rect.shiftrect."+intStr[e]).attr("y",function(e,t){return y(t+1)});S.selectAll("text.shifttext."+intStr[e]).attr("y",function(e,t){return y(t+1)+11})}}else{S.selectAll("rect.shiftrect").attr("y",function(e,t){return y(t+1)});S.selectAll("text.shifttext").attr("y",function(e,t){return y(t+1)+11})}d3.select(".y.axis").call(C);d3.selectAll(".tick line").style({stroke:"black"})}var a={top:0,right:0,bottom:0,left:0},f=500-a.left-a.right,l=600-a.top-a.bottom,c=.775*f,h=.775*l,p=c/2,d=101,v=100,m=95,g=22,b=false;e.select(".canvas").remove();var w=e.append("svg").attr("width",f).attr("height",l).attr("class","canvas");x=d3.scale.linear().domain([-Math.abs(t[0]),Math.abs(t[0])]).range([(r[0].length+3)*9,c-(r[0].length+3)*9]);y=d3.scale.linear().domain([g,1]).range([h,d]);var E=d3.behavior.zoom().y(y).scaleExtent([1,1]).on("zoom",H);var S=w.append("g").attr("transform","translate("+.125*f+","+(1-.125-.775)*l+")").attr("width",c).attr("height",h).attr("class","main").call(E);S.append("svg:rect").attr("width",c).attr("height",h).attr("class","bg").style({"stroke-width":"2",stroke:"rgb(0,0,0)"}).attr("fill","#FCFCFC");var T=function(){return d3.svg.axis().ticks(4).scale(x).orient("bottom")};var N=function(){return d3.svg.axis().scale(y).orient("left")};var C=N().innerTickSize(6).outerTickSize(0);S.append("g").attr("class","y axis ").attr("font-size","14.0px").attr("transform","(0,0)").call(C);var k=T().innerTickSize(6).outerTickSize(0);S.append("g").attr("class","x axis ").attr("font-size","14.0px").attr("transform","translate(0,"+h+")").call(k);d3.selectAll(".tick line").style({stroke:"black"});var L=S.append("svg:clipPath").attr("id","clip").append("svg:rect").attr("x",0).attr("y",v).attr("width",c).attr("height",h-v);var A=S;A.append("line").attr("x1",0).attr("x2",c).attr("y1",m).attr("y2",m).style({"stroke-width":"2",stroke:"black"});var O=Math.max(Math.abs(s[1]),Math.abs(s[2]),s[0],s[3]);topScale=d3.scale.linear().domain([-O,O]).range([c*.1,c*.9]);var M=[s[3],s[0],s[3]+s[1],d3.sum(s)];A.selectAll(".sumrectR").data(M).enter().append("rect").attr("fill",function(e,t){if(t==0){return"#FFFF4C"}else if(t==1){return"#B3B3FF"}else if(t==2){if(e>0){return"#FFFF4C"}else{return"#FFFFB3"}}else{return"#272727"}}).attr("class","sumrectR").attr("x",function(e,t){if(e>0){return p}else{return topScale(e)}}).attr("y",function(e,t){if(t<3){return t*22+7}else{return t*22+1}}).style({opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)"}).attr("height",function(e,t){return 17}).attr("width",function(e,t){if(e>0){return topScale(e)-p}else{return p-topScale(e)}}).on("mouseover",function(e){var t=d3.select(this).style({opacity:"1.0"})}).on("mouseout",function(e){var t=d3.select(this).style({opacity:"0.7"})}).on("click",function(e,t){b=true;P();if(t==0){d3.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform","translate(0,0)");d3.selectAll("text.shifttext.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform","translate(0,0)")}else if(t==1){d3.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform","translate(0,0)");d3.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform","translate(0,0)");d3.selectAll("text.shifttext.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}});A.selectAll(".sumtextR").data([s[3],s[0],d3.sum(s)]).enter().append("text").attr("class","sumtextR").style("text-anchor",function(e,t){if(e>0){return"start"}else{return"end"}}).attr("y",function(e,t){if(t<2){return t*22+22}else if((s[3]+s[1])*(s[0]+s[2])<0){return t*22+39}else{return t*22+30}}).text(function(e,t){if(t==0){return"∑+↑"}if(t==1){return"∑-↓"}else{return"∑"}}).attr("x",function(e,t){return topScale(e)+5*e/Math.abs(e)});var M=[s[1],s[2],s[0]+s[2]];A.selectAll(".sumrectL").data(M).enter().append("rect").attr("fill",function(e,t){if(t==0){return"#FFFFB3"}else if(t==1){return"#4C4CFF"}else{if(e>0){return"#B3B3FF"}else{return"#4C4CFF"}}}).attr("class","sumrectL").attr("x",function(e,t){if(t<2){return topScale(e)}else{if((s[3]+s[1])*(s[0]+s[2])>0){if(e>0){return topScale(s[3]+s[1])}else{return topScale(e)-(p-topScale(s[3]+s[1]))}}else{if(e>0){return p}else{return topScale(e)}}}}).attr("y",function(e,t){return t*22+7}).style({opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)"}).attr("height",function(e,t){return 17}).attr("width",function(e,t){if(e>0){return topScale(e)-p}else{return p-topScale(e)}}).on("mouseover",function(e){var t=d3.select(this).style({opacity:"1.0"})}).on("mouseout",function(e){var t=d3.select(this).style({opacity:"0.7"})}).on("click",function(e,t){b=true;P();if(t==0){d3.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform","translate(0,0)");d3.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform","translate(0,0)");d3.selectAll("text.shifttext.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}else if(t==1){d3.selectAll("rect.shiftrect.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform","translate(0,0)");d3.selectAll("rect.shiftrect.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("rect.shiftrect.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.zero").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.two").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform","translate(0,0)");d3.selectAll("text.shifttext.one").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}});d3.selectAll("text.shifttext.three").transition().duration(1e3).attr("y",function(e,t){return y(t+1)+11}).attr("transform",function(e,t){if(e<0){return"translate(-500,0)"}else{return"translate(500,0)"}})}});A.selectAll(".sumtextL").data([s[1],s[2]]).enter().append("text").attr("class","sumtextL").style("text-anchor","end").attr("y",function(e,t){return t*22+22}).text(function(e,t){if(t==0){return"∑+↓"}else{return"∑-↑"}}).attr("x",function(e,t){return topScale(e)-5});S=S.append("g").attr("clip-path","url(#clip)");w.append("text").text("Word Rank").attr("class","axes-text").attr("x",(f-c)/4).attr("y",l/2+30).attr("font-size","16.0px").attr("fill","#000000").attr("transform","rotate(-90.0,"+(f-c)/4+","+(l/2+30)+")");w.append("text").text("Per word average happiness shift").attr("class","axes-text").attr("x",c/2+(f-c)/2).attr("y",3*(l-h)/4+h).attr("font-size","16.0px").attr("fill","#000000").attr("style","text-anchor: middle;");if(u>=o){var _="happier"}else{var _="less happy"}w.selectAll(".sumtext").data(["Why ",o,u]).enter().append("text").text(function(e,t){if(t==0){if(Math.abs(o-u)<.01){return"How the words of reference and comparison differ"}else{return e+"comparison "+" is "+_+" than "+"reference "}}else if(t==1){return"Reference happiness "+e.toFixed(2)}else{return"Comparison happiness "+e.toFixed(2)}}).attr("class","axes-text").attr("x",c/2+(f-c)/2).attr("y",function(e,t){return t*20+13}).attr("font-size","16.0px").attr("fill","#000000").attr("style","text-anchor: middle;");intStr=["zero","one","two","three"];S.selectAll("rect.shiftrect").data(t).enter().append("rect").attr("fill",function(e,t){if(n[t]==2){return"#4C4CFF"}else if(n[t]==3){return"#FFFF4C"}else if(n[t]==0){return"#B3B3FF"}else{return"#FFFFB3"}}).attr("class",function(e,t){return"shiftrect "+intStr[n[t]]}).attr("x",function(e,t){if(e>0){return p}else{return x(e)}}).attr("y",function(e,t){return y(t+1)}).style({opacity:"0.7","stroke-width":"1",stroke:"rgb(0,0,0)"}).attr("height",function(e,t){return 15}).attr("width",function(e,t){if(e>0){return x(e)-p}else{return p-x(e)}}).on("mouseover",function(e){var t=d3.select(this).style({opacity:"1.0"})}).on("mouseout",function(e){var t=d3.select(this).style({opacity:"0.7"})});var D=Array(r.length);S.selectAll("text.shifttext").data(t).enter().append("text").attr("class",function(e,t){return"shifttext "+intStr[n[t]]}).style("text-anchor",function(e,n){if(t[n]<0){return"end"}else{return"start"}}).attr("y",function(e,t){return y(t+1)+11}).text(function(e,i){if(n[i]==0){tmpStr="-↓"}else if(n[i]==1){tmpStr="↓+"}else if(n[i]==2){tmpStr="↑-"}else{tmpStr="+↑"}if(t[i]<0){return tmpStr.concat(r[i])}else{return r[i].concat(tmpStr)}}).attr("x",function(e,t){if(e>0){return x(e)+2}else{return x(e)-2}}).on("click",function(e,s){if(D[s]){if(n[s]==0){tmpStr="-↓"}else if(n[s]==1){tmpStr="↓+"}else if(n[s]==2){tmpStr="↑-"}else{tmpStr="+↑"}if(t[s]<0){tmpStr=tmpStr.concat(r[s])}else{tmpStr=r[s].concat(tmpStr)}D[s]=0}else{if(n[s]==0){tmpStr="-↓"}else if(n[s]==1){tmpStr="↓+"}else if(n[s]==2){tmpStr="↑-"}else{tmpStr="+↑"}if(t[s]<0){tmpStr=tmpStr.concat(i[s])}else{tmpStr=i[s].concat(tmpStr)}D[s]=1}newText=d3.select(this).text(tmpStr)});S.insert("text","rect").attr("class","credit").text("by Andy Reagan").attr("fill","#B8B8B8").attr("x",314).attr("y",460).attr("font-size","8.0px")}
